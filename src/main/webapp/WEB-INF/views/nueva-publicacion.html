<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Publicación</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/resources/css/style.css}">
    <style>
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin: 10px 0;
        }

        .additional-images-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
    </style>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg green-section bg-light">
    <div class="container">
        <a href="#" class="navbar-brand">Logo</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="fa-solid fa-circle-user text-black fs-1"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto d-none d-lg-flex">
                <li class="nav-item dropdown">
                    <a class="nav-link text-white fs-5" href="#" role="button" data-bs-toggle="dropdown" id="dr">
                        <i class="fa-solid fa-circle-user text-black fs-2"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="/user-account">Cuenta</a></li>
                        <li><a class="dropdown-item" href="/logout">Cerrar Sesión</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4 mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Nuevo Anuncio</h3>
                </div>
                <div class="card-body">
                    <form th:action="@{/dashboard/profesional/anuncios/guardar}" method="post" enctype="multipart/form-data"
                          th:object="${publicacion}">
                        <!-- Título -->
                        <div class="mb-3">
                            <label for="titulo" class="form-label">Título del anuncio</label>
                            <input type="text" class="form-control" id="titulo" th:field="*{titulo}" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('titulo')}"
                                 th:errors="*{titulo}"></div>
                        </div>

                        <!-- Descripción -->
                        <div class="mb-3">
                            <label for="descripcion" class="form-label">Descripción</label>
                            <textarea class="form-control" id="descripcion" th:field="*{descripcion}" rows="5"
                                      required></textarea>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('descripcion')}"
                                 th:errors="*{descripcion}"></div>
                        </div>

                        <!-- Categoría -->
                        <div class="mb-3">
                            <label for="categoria" class="form-label">Categoría</label>
                            <select class="form-select" id="categoria" th:field="*{categoria}" required>
                                <option value="" disabled selected>Selecciona una categoría</option>
                                <option th:each="cat : ${T(azc.uam.app.model.enums.Categoria).values()}"
                                        th:value="${cat}"
                                        th:text="${cat.nombre}"></option>
                            </select>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('categoria')}"
                                 th:errors="*{categoria}"></div>
                        </div>

                        <!-- Precio -->
                        <div class="mb-3">
                            <label for="precio" class="form-label">Precio ($)</label>
                            <input type="number" class="form-control" id="precio" th:field="*{precio}" step="0.01"
                                   min="0" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('precio')}"
                                 th:errors="*{precio}"></div>
                        </div>

                        <!-- Imagen Principal -->
                        <div class="mb-3">
                            <label for="imagenPrincipal" class="form-label">Imagen Principal (Obligatoria)</label>
                            <input type="file" class="form-control" id="imagenPrincipal" name="imagenPrincipal"
                                   accept="image/*" required
                                   onchange="previewImage(this, 'principalPreview')">
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('imagenPrincipal')}">Debes subir al
                                menos una imagen
                            </div>
                            <img id="principalPreview" class="image-preview d-none" alt="Vista previa imagen principal">
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a th:href="@{/profesional-dashboard}" class="btn btn-secondary me-md-2">Cancelar</a>
                            <button type="submit" class="btn btn-primary">Publicar Anuncio</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Vista previa de la imagen principal
    function previewImage(input, previewId) {
        const preview = document.getElementById(previewId);
        const file = input.files[0];

        if (file) {
            const reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.classList.remove('d-none');
            }

            reader.readAsDataURL(file);
        } else {
            preview.src = '';
            preview.classList.add('d-none');
        }
    }

    // Vista previa de imágenes adicionales
    function previewAdditionalImages(input) {
        const container = document.getElementById('additionalImagesContainer');
        container.innerHTML = '';

        if (input.files) {
            for (let i = 0; i < input.files.length; i++) {
                const reader = new FileReader();
                const file = input.files[i];

                reader.onload = function (e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'image-preview';
                    img.alt = 'Vista previa imagen adicional ' + (i + 1);
                    container.appendChild(img);
                }

                reader.readAsDataURL(file);
            }
        }
    }

    // Validación del formulario
    (function () {
        'use strict';

        const forms = document.querySelectorAll('.needs-validation');

        Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }

                form.classList.add('was-validated');
            }, false);
        });
    })();
</script>
</body>
</html>