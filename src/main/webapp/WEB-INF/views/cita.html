<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Agendar Cita</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        .time-slot {
            background-color: #f3f0ff;
            border: 1px solid #d6ccf1;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 4px;
            cursor: pointer;
            display: inline-block;
        }

        .time-slot:hover {
            background-color: #e2dbfa;
        }

        .time-slot.selected {
            background-color: #5b21b6;
            color: white;
        }

        .calendar-scroll {
            max-height: 450px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <div class="row" th:each="publicacion : ${publicaciones}">
        <!-- IZQUIERDA: Información de la publicación -->
        <div class="col-md-6">
            <h3 th:text="${publicacion.titulo}">Título</h3>
            <p class="text-muted" th:text="${publicacion.categoria}">Categoría</p>

            <img th:src="@{'/uploads/' + ${publicacion.imagenPrincipal}}" class="img-fluid rounded mb-3" alt="Imagen principal">

            <p th:text="${publicacion.descripcion}">Descripción de la publicación...</p>
            <p><strong>Precio:</strong> $<span th:text="${publicacion.precio}">500</span> MXN</p>
            <p><strong>Publicado por:</strong> <span th:text="${publicacion.usuario.nombre}">Nombre Usuario</span></p>

            <a th:href="@{'/dashboard/cliente'}"
               class="btn btn-success w-100 mt-3">Volver</a>
        </div>

        <!-- DERECHA: Calendario -->
        <div class="col-md-6">
            <h4>Agenda tu cita</h4>

            <form method="post" th:action="@{/dashboard/cliente/agendar-cita}">
                <input type="hidden" name="correoProfesional" th:value="${publicacion.usuario.getCorreo()}" />
                <input type="hidden" id="selectedDate" name="fecha" th:value="${fechaSeleccionada}"/>
                <input type="hidden" id="selectedTime" name="hora" th:value="${horaSeleccionada}"/>
                <div class="calendar-scroll mb-3">
                    <div class="row text-center">
                        <div class="col" th:each="entry : ${diasDisponibles}">
                            <strong th:text="${#temporals.format(entry.key, 'E dd/MM')}">Lun 05/08</strong>
                            <div th:each="hora : ${entry.value}"
                                 class="time-slot"
                                 th:text="${hora}"
                                 th:attr="data-fecha=${#temporals.format(entry.key, 'yyyy-MM-dd')},data-hora=${hora}">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-2">
                    <label>¿Es tu primera visita?</label><br>
                    <input type="radio" name="primeraVisita" value="true" checked> Sí
                    <input type="radio" name="primeraVisita" value="false"> No
                </div>

                <button type="submit" class="btn btn-primary w-100">Agendar Cita</button>
            </form>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.time-slot').forEach(slot => {
        slot.addEventListener('click', () => {
            document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
            slot.classList.add('selected');
            document.getElementById('selectedDate').value = slot.dataset.fecha;
            document.getElementById('selectedTime').value = slot.dataset.hora;
        });
    });
</script>
</body>
</html>
